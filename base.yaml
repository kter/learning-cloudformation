AWSTemplateFormatVersion: '2010-09-09'
Resources:
  InstantDevVPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 172.16.10.0/24
      Tags:
      - Key: Name
        Value: InstantDevVPC
  InternetGateway:
    Type: AWS::EC2::InternetGateway
    Properties:
      Tags:
      - Key: Name
        Value: InstantDevIGW
  AttachGateway:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId: !Ref InstantDevVPC
      InternetGatewayId: !Ref InternetGateway
  FrontendRouteTable:
    Type: AWS::EC2::RouteTable
    DependsOn: AttachGateway
    Properties:
      VpcId: !Ref InstantDevVPC
      Tags:
      - Key: Name
        Value: InstantDevFrontendRoute
  FrontendRoute:
    Type: AWS::EC2::Route
    DependsOn: AttachGateway
    Properties:
      RouteTableId: !Ref FrontendRouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway
  FrontendSubnet:
    Type: AWS::EC2::Subnet
    DependsOn: AttachGateway
    Properties:
      CidrBlock: 172.16.10.0/24
      MapPublicIpOnLaunch: 'true'
      VpcId: !Ref InstantDevVPC
      Tags:
      - Key: Name
        Value: InstantDevVPCFrontendSubnet
  FrontendSubnetRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref FrontendSubnet
      RouteTableId: !Ref FrontendRouteTable
  DefaultSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    DependsOn: InstantDevVPC
    Properties:
      GroupDescription: default security group
      VpcId: !Ref InstantDevVPC
      SecurityGroupIngress:
        - IpProtocol: "-1"
          CidrIp: 172.31.0.0/16
          FromPort: '0'
          ToPort: '65535'
  #DefaultSecurityGroupIngress:
  #  Type: 'AWS::EC2::SecurityGroupIngress'
  #  DependsOn: DefaultSecurityGroup
  #  Properties:
  #    GroupId: !Ref DefaultSecurityGroup
  #    IpProtocol: "-1"
  #    FromPort: '0'
  #    ToPort: '65535'
  #    SourceSecurityGroupId: !Ref DefaultSecurityGroup
  WebSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    DependsOn: InstantDevVPC
    Properties:
      GroupDescription: http and https
      VpcId: !Ref InstantDevVPC
      SecurityGroupIngress:
        - IpProtocol: tcp
          CidrIp: 0.0.0.0/0
          FromPort: '80'
          ToPort: '80'
        - IpProtocol: tcp
          CidrIp: 0.0.0.0/0
          FromPort: '443'
          ToPort: '443'
  SshSecurityGroup:
    Type: 'AWS::EC2::SecurityGroup'
    DependsOn: InstantDevVPC
    Properties:
      GroupDescription: ssh
      VpcId: !Ref InstantDevVPC
      SecurityGroupIngress:
        - IpProtocol: tcp
          CidrIp: 8.8.8.8/32
          FromPort: '22'
          ToPort: '22'
